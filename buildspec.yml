version: 0.2

phases:
  pre_build:
    commands:
      - echo Nothing to do in the pre_build phase...
      - docker-compose -f ./.build/docker-compose.yml up -d
      - docker-compose exec -T php-fpm composer install
      - docker-compose exec -T \
        -e PIMCORE_INSTALL_ADMIN_USERNAME=pimcore \
        -e PIMCORE_INSTALL_ADMIN_PASSWORD=pimcore \
        -e PIMCORE_INSTALL_MYSQL_USERNAME=pimcore \
        -e PIMCORE_INSTALL_MYSQL_PASSWORD=pimcore \
        -- \
        php-fpm vendor/bin/pimcore-install -n --mysql-host-socket=db --mysql-database=pimcore

  build:
    commands:
      - echo Build started on `date`
  post_build:
    commands:
      - echo Build completed on `date`
